function ShowAnswerList(n){var t=cmtCinfig["key_"+n];t==null||t==undefined?(cmtCinfig["key_"+n]={p:1,show:!0,total:0},$("#showCommentsPageList_"+n).show(),LoadAnswerComments(n,1)):t.show?($("#showCommentsPageList_"+n).hide(),t.show=!1):($("#showCommentsPageList_"+n).show(),t.show=!0)}function AddAnswerComment(n){var t=[],i,r;if(t.push({id:$("#AnswerCommentsContents_"+n),required:{tip:"请输入评论内容"},length:{min:1,max:500}}),i=$.Validator({items:t}),i.Create())r=layer.load(2),$("#commentCommentsForm_"+n).ajaxSubmit({type:"post",url:"/Posts/AddAnswerComments",success:function(t){if(layer.close(r),t){var i=new $.zui.Messager("评论成功",{icon:"ok-sign",type:"success",placement:"center",time:0}).show();setTimeout(function(){i.hide()},1500);$("#commentCommentsForm_"+n).resetForm();$("#commentCommentsForm_"+n).find("textarea[name='contents']").attr("placeholder","撰写评论...");$("#commentCommentsForm_"+n).find("input[name='toUserId']").val(0);$.ajax({type:"get",url:"/Posts/LoadCommentsByTotal",data:"answerId="+n,success:function(t){var i=parseInt(t),u=1,r=6;u=i%r==0?i/r:parseInt(i/r)+1;cmtCinfig["key_"+n].total=i;LoadAnswerComments(n,u)}})}}});else return!1}function LoadAnswerComments(n,t){$("#showCommentsPageList_"+n).find(".comment").remove();$.ajax({type:"get",url:"/Posts/LoadComments",data:"answerId="+n+"&pageIndex="+t,success:function(i){console.log(i);var r=JSON.parse(i);$.each(r,function(n){CreateCommentsHtml(r[n])});cmtCinfig["key_"+n].total==0?$.ajax({type:"get",url:"/Posts/LoadCommentsByTotal",data:"answerId="+n,success:function(i){var r=parseInt(i);CreatePageHtml(n,r,t);cmtCinfig["key_"+n].total=r}}):CreatePageHtml(n,cmtCinfig["key_"+n].total,t)}})}function CreatePageHtml(n,t,i){var f=0,e=6,o,s,h,u,r;for(f=t%e==0?t/e:parseInt(t/e)+1,o=1,i>6&&(o=i-6),s=f,f-i>6&&(s=i+6),h="",u='<ul class="pager" id="showCommentsPage_'+n+'">',r=o;r<=s;r++)u+=i==r?'<li><span style="font-weight:Bold;color:red;">'+r+"<\/span><\/li>":'<li><a href="javascript:LoadAnswerComments('+n+","+r+')">'+r+"<\/a><\/li>";u+="<\/ul>";$("#showCommentsPage_"+n).remove();$("#showCommentsPageList_"+n).append(u)}function CreateCommentsHtml(n){var t='<div class="comment">';t+='<div class="content">';t+='<div class="pull-right text-muted">'+n.PostDate+"<\/div>";t+='<div><img src="'+n.HeadUrl+'" width="25px" height="25px" class="img-rounded" /><strong style="margin-left:10px;">'+n.NickName+"<\/strong>"+(n.ToUserId!=0?'<span class="text-muted" style="margin-left:5px;">回复<\/span> <strong>'+n.ToUserNickName+"<\/strong>":"")+"<\/div>";t+='<div class="text">'+(n.IsShow?n.Contents:'<div class="text bg-info">该内容已经失联,我们在火星发现了Ta的踪迹...<\/div>')+"<\/div>";t+='<div class="actions">';t+='<button onclick="AddCommentsPlus('+n.CommentId+');"  class="btn btn-link" style="padding:1px;color:#808080;"><i class="icon icon-thumbs-up"><\/i><span id="commentsPlus_'+n.CommentId+'">'+n.Plus+"<span><\/button>";t+='<button data-cmd="comment" data-user="'+n.UserId+'" data-name="'+n.NickName+'"  class="btn btn-link" style="margin-left:10px;padding:1px;color:#808080;"><i class="icon icon-reply"><\/i>回复<\/button>';t+="<\/div>";t+="<\/div>";t+="<\/div >";t=$(t);$(t).find("button[data-cmd='comment']").click(function(){var i,t,r;IsLogin?(i=$(this).attr("data-user"),t=$("#commentCommentsForm_"+n.AnswerId),$(t).find("input[name='toUserId']").val(i),$(t).find("textarea[name='contents']").attr("placeholder","回复["+$(this).attr("data-name")+"]:")):(r=new $.zui.Messager("请您先登录.",{icon:"ok-sign",type:"success",placement:"center",time:0}).show(),setTimeout(function(){r.hide(function(){})},1500))});$("#showCommentsPageList_"+n.AnswerId).append(t)}$("#btn_PostAnswer").click(function(){var n,t,i;if($("#contents").val(tinymce.get("contents").getContent()),n=[],n.push({id:$("#contents"),required:{},length:{min:1,max:2e4}}),t=$.Validator({items:n}),t.Create())i=layer.load(2),$("#AnswerForm").ajaxSubmit({success:function(n){layer.close(i);n&&layer.msg("发布成功",function(){window.location.href=window.location.href})}});else return!1});var cmtCinfig=[];