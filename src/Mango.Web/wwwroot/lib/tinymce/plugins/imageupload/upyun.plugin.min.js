tinymce.PluginManager.add("imageupload",function(n){function t(){var i=n.dom,t=$('<input type="file" name="file" accept="image/jpg,image/jpeg,image/png,image/gif" multiple="multiple">');t.on("change",function(){var r=t[0].files[0];console.log(r);$.ajax({type:"post",url:"/File/UPYun",data:"fileName="+r.name,success:function(t){if(t!=""){var f=JSON.parse(t),u=new FormData;u.append("file",r);u.append("authorization",f.Signature);u.append("policy",f.Policy);$.ajax({type:"post",url:n.settings.upload_image_url,data:u,processData:!1,contentType:!1,success:function(){n.selection.setContent(i.createHTML("img",{src:n.settings.file_server_url+f.Path}))},error:function(n){cfg.error(n)}})}else alert("文件上传失败")}})});t.click()}n.addCommand("mceUploadImageEditor",t);n.ui.registry.addButton("imageupload",{icon:"image",tooltip:"图片上传",onAction:t});n.ui.registry.addMenuItem("imageupload",{icon:"image",text:"图片上传",context:"tools",onAction:t})});