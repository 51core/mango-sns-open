(function(n){n.FlyUpload=function(t){function r(){for(var t=null,u=0,r;i.filelist.length>0;)t=i.filelist.pop(),t!=null&&t!=undefined&&(commonConfig.ossName=="local"?(r=new FormData,r.append("file",t.content),r.append("filename",t.name),n.ajax({type:"post",url:commonConfig.serverUrl,data:r,processData:!1,contentType:!1,success:function(){i.success(json.Path)},error:function(n){i.error(n)}})):commonConfig.ossName=="upyun"&&n.ajax({type:"post",url:"/File/UPYun",data:"fileName="+t.name,success:function(r){if(r!=""){var f=JSON.parse(r),u=new FormData;u.append("file",t.content);u.append("authorization",f.Signature);u.append("policy",f.Policy);n.ajax({type:"post",url:commonConfig.serverUrl,data:u,processData:!1,contentType:!1,success:function(){i.success(f.Path)},error:function(n){i.error(n)}})}else alert("文件上传失败")}}),u++);u==0&&alert("当前文件队列中无可上传的文件!")}function u(n){for(var i=!1,t=0;t<commonConfig.format.length;t++)if(n.indexOf("."+commonConfig.format[t])>-1){i=!0;break}return i}var i={id:null,auto:!0,upbutton:null,success:function(n){alert("上传成功,图片地址:"+n)},error:function(n){console.log(n)},filelist:[]};(function(){t.id!=null&&t.id!=undefined&&(i.id=t.id);t.auto!=null&&t.auto!=undefined&&(i.auto=t.auto);t.upbutton!=null&&t.upbutton!=undefined&&(i.upbutton=t.upbutton);t.preview!=null&&t.preview!=undefined&&(i.preview=t.preview);t.success!=null&&t.success!=undefined&&(i.success=t.success);t.error!=null&&t.error!=undefined&&(i.error=t.error);var n=document.getElementById(i.id);typeof FileReader=="undefined"?(alert("当前浏览器不支持H5上传"),n.setAttribute("disabled","disabled")):n.addEventListener("change",function(){var f=this.files.length,t,e;for(f>i.maxcount&&(f=i.maxcount),t=0;t<f;t++)u(n.value)?this.files[t].size<=commonConfig.maxSize?(e=new FileReader,e.readAsDataURL(this.files[t]),e.onload=function(){i.preview(this.result)},i.filelist.unshift({name:n.value,content:this.files[t]})):alert("上传的文件不能超过指定大小"):console.log("上传的图片格式不正确,请重新选择");i.auto?r():i.upbutton!=null&&i.upbutton==undefined?document.getElementById(i.upbutton).addEventListener("click",function(){r()},!1):r()},!1)})()}})(jQuery);